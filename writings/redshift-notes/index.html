<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.14.0"/><style data-href="/styles.0a20b925c07e2cc94461.css" data-identity="gatsby-global-css">.globals-module--centered-text--f1021{text-align:center}.globals-module--nav-link-text--78591{color:#2f4f4f}.globals-module--nav-link-current-item--312f0{text-decoration:none}.globals-module--site-image--59f09{border-radius:5px}@keyframes globals-module--flare--21b39{0%{opacity:0}to{font-size:20px;opacity:1}}.layout-module--container--4f29e{font-family:Courier New,monospace;margin:auto;max-width:500px;min-height:100vh;position:relative}.layout-module--footer--f8364{padding:20px 0;position:absolute;width:100%}.layout-module--nav-links--a181c{display:flex;list-style:none;padding-bottom:20px;padding-left:0;padding-top:20px}.layout-module--nav-link-item--fbd31{padding-right:2rem}.layout-module--resume--53a60{padding-bottom:20px}.photoGallery-module--gallery--ec7ee{display:grid;gap:1rem;grid-template-columns:repeat(auto-fill,minmax(250px,1fr))}.photoGallery-module--gallery-item--9fdd1{border-radius:5px;overflow:hidden;position:relative}.photoGallery-module--gallery-item--9fdd1:hover{filter:drop-shadow(5px 5px 15px darkslategrey)}.photoGallery-module--gallery-item--9fdd1 img{height:100%;object-fit:cover;position:absolute;width:100%}.photoGallery-module--gallery-item--9fdd1 img:hover{transform:scale(1.05)}.tools-module--container--f04d6{font-family:Courier New,monospace;margin:auto;position:relative}.tools-module--content-container--d2a7e{align-items:center;display:flex;flex-direction:row;justify-content:center;position:relative}.tools-module--description--6df14{flex:0 2 auto;font-weight:lighter;padding:0 20px;position:relative}.tools-module--image--1f058{box-shadow:10px;flex:2 0 auto;position:relative}.writings-module--post--fa2ad{font-family:Georgia,serif}.writings-module--preview-container--33267{display:inline}.writings-module--date--4bb92{color:#2f4f4f;font-size:69%;font-style:italic;font-weight:700;text-align:end}table{table-layout:fixed;width:100%}th{padding-bottom:10px}td{text-align:left}.writings-module--three-column--7af25 td:nth-child(3){text-align:right}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-J596TM92WV"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-J596TM92WV', {"send_page_view":false});
      }
      </script></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout-module--container--4f29e"><title>steebe - HOME</title><nav><ul class="layout-module--nav-links--a181c"><li class="layout-module--nav-link-item--fbd31"><a class="globals-module--nav-link-text--78591 globals-module--nav-link-current-item--312f0" href="/">HOME</a></li><li class="layout-module--nav-link-item--fbd31"><a class="globals-module--nav-link-text--78591" href="/tools">TOOLS</a></li><li class="layout-module--nav-link-item--fbd31"><a class="globals-module--nav-link-text--78591" href="/writings">BLOG</a></li><li class="layout-module--nav-link-item--fbd31"><a class="globals-module--nav-link-text--78591" href="/about">ABOUT</a></li></ul></nav><main><p class="writings-module--date--4bb92"><i>May 9, 2023</i><br/></p><div class="writings-module--post--fa2ad"><p>Below are helpful commands I don&#x27;t want to forget for Redshift admin and use. Those interested in a small torching
of Redshift as a product are welcome to read the <a href="./redshift-opinion">sibling post</a>.</p>
<hr/>
<h2>Querying</h2>
<h3>A Distinct &quot;<code>DISTINCT</code>&quot;</h3>
<p><strong>PostgreSQL</strong> users might be familiar with the ability to use <code>DISTINCT</code> as an expression evaluator, rather
than a clause, to reduce the result set down to records that only include the value evaluated by the
expression.</p>
<p><strong>MySQL</strong> users might be used to leveraging <code>GROUP BY</code> in a different way than normal
to do the same.</p>
<p>I.E: if I have a table, <code>orders</code>:</p>
<table border="1" frame="outside"><tr><th>id</th><th>customerId</th></tr><tr><td>1</td><td>1</td></tr><tr><td>2</td><td>1</td></tr><tr><td>3</td><td>1</td></tr></table>
<p>Our first customer was keeping the lights on, and proved that the <code>orders</code> table has a many:one
relationship with the <code>customers</code> table.</p>
<p>Suppose we need to pull the latest order for each customer, in a world where there is not just
a sole customer placing orders. Additionally, the context of the report involves many other fields are being
aggregated across dozens of other tables. <code>LIMIT 1</code> is not coming to the rescue.</p>
<p>Postgres allows for:</p>
<pre><code class="language-sql">SELECT
    DISTINCT ON(customerId) customerId,
    id
FROM orders
ORDER BY customerId, id DESC;
</code></pre>
<p>Okay, cool. Weird, but cool. The developer specifies they <em>only</em> want unique <code>customerId</code> values
in their results, but want the respective order information along with it. Postgres constructs
groups based on the argument provided to <code>DISTINCT ON</code>, then omits any records that break the unique
value specified. The <code>ORDER BY</code> gives the developer control over precedence on which distinct records
to honor.</p>
<p>MySQL perhaps helps visualize this better, literally making the developer create the groups themselves:
<code>ORDER BY</code>:</p>
<pre><code class="language-sql">WITH disctinct_customer_id_orders AS (
    SELECT
        id
    FROM orders
    GROUP BY customerId
)
SELECT * FROM distinct_customer_id_orders ORDER BY id DESC;
</code></pre>
<p>It&#x27;s still not perfect, either, because the <code>ORDER BY</code> should happen in the first query, but hey, MySQL tries.</p>
<h4>Redshift does neither...</h4>
<p>...yet I don&#x27;t hate how Redshift achieves the same outcome, strictly from the developer
experience side of things:</p>
<pre><code class="language-sql">SELECT
    *
FROM (
    SELECT
        id,
        customerId,
        RANK() OVER (PARTITION BY customerId ORDER BY id DESC) AS customer_id_rank
    FROM orders
) as ranked_orders
WHERE ranked_orders.customer_id_rank = 1;
</code></pre>
<p>Where Redshift could have continued reinventing an already finished, rehashed,
re-spoked wheel of relational-algebra powered query engines, it instead took the modest route.</p>
<p>The developer is welcome to rewrite <code>GROUP BY</code> on Amazon&#x27;s behalf. Also, the developer gets a bonus
column in their toolkit to play with. It&#x27;s okay that the result set grew though, because it&#x27;s powered
by a warehouse meant for Big Data!</p>
<h2>Administering</h2>
<h3>Groups &amp; Users</h3>
<pre><code class="language-sql">-- Create groups
CREATE GROUP MY_GROUP [WITH USER (user1, user2,...)];

-- View all user groups (as cluster admin)
SELECT * from PG_GROUP;

-- View all users in a group
SELECT usename FROM pg_user, pg_group
WHERE pg_user.usesysid = ANY(pg_group.grolist)
  AND pg_group.groname = &#x27;&lt;group-name&gt;&#x27;;

-- Apply to entire schema
GRANT ALL ON SCHEMA my_schema TO GROUP my_group;

-- Apply to specific tables
GRANT SELECT ON TABLE my_table TO my_user;

-- Apply read-only access to specific (or all) tables in a single schema
GRANT SELECT ON ALL TABLES IN SCHEMA my_schema TO my_user;

-- Create user
CREATE USER my_user PASSWORD &#x27;&lt;pass-string&gt;&#x27;;

-- Create user under specific group
CREATE USER my_user IN GROUP my_group PASSWORD &#x27;pass&#x27;;

-- Alter existing user
ALTER USER my_user PASSWORD &#x27;new-pass&#x27;;
</code></pre>
<h3>Cluster Metadata</h3>
<pre><code class="language-sql">-- View tables within a Schema
select distinct tablename from pg_table_def where schemaname = &#x27;&lt;schema-name&gt;&#x27;;

-- View all schemas in a cluster
select * from pg_namespace;

-- View connection activity within a cluster
select * from stl_connection_log
where recordtime &gt; &#x27;2021-02-07 00:00:00&#x27; and username in (&#x27;user1&#x27;, &#x27;user2&#x27;)
order by recordtime DESC;
</code></pre></div></main><footer class="globals-module--centered-text--f1021 layout-module--footer--f8364"><div class="layout-module--resume--53a60"><a href="./steve_bass_resume.pdf" class="globals-module--nav-link-text--78591" target="_blank">RESUME</a></div><a href="https://www.github.com/steebe" target="_blank" class="globals-module--nav-link-text--78591 layout-module--nav-link-item--fbd31" rel="noreferrer">GITHUB</a><a href="https://www.linkedin.com/in/steebe" target="_blank" class="globals-module--nav-link-text--78591" rel="noreferrer">LINKEDIN</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/writings/redshift-notes";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-8d476775be3aedc48f61.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-47db0f8a9c3e39834292.js\"],\"component---src-pages-about-tsx\":[\"/component---src-pages-about-tsx-49c66392c2ad917b5f8e.js\"],\"component---src-pages-index-tsx\":[\"/component---src-pages-index-tsx-322035b37eb58a97e515.js\"],\"component---src-pages-photos-tsx\":[\"/component---src-pages-photos-tsx-7ca88b654073d63955a6.js\"],\"component---src-pages-tools-tsx\":[\"/component---src-pages-tools-tsx-d57c2e793a2b6a04c750.js\"],\"component---src-pages-writings-index-tsx\":[\"/component---src-pages-writings-index-tsx-b6869ad3fc14cb3fe35d.js\"],\"component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-2023-swoosh-mdx\":[\"/component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-2023-swoosh-mdx-eafe7eeafc95344850ec.js\"],\"component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-apple-mdx\":[\"/component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-apple-mdx-4870cd4365fdb6351e69.js\"],\"component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-broken-windows-mdx\":[\"/component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-broken-windows-mdx-b069433f17a1dd80d169.js\"],\"component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-burning-images-to-usb-mdx\":[\"/component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-burning-images-to-usb-mdx-63445a8defeb5039dde3.js\"],\"component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-bye-gatsby-mdx\":[\"/component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-bye-gatsby-mdx-a756cbc726cce36d6fbf.js\"],\"component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-climbers-hash-mdx\":[\"/component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-climbers-hash-mdx-863a820198ee4b6a6ca2.js\"],\"component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-ging-mdx\":[\"/component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-ging-mdx-31e80f9414c5f0207274.js\"],\"component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-git-intermediate-mdx\":[\"/component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-git-intermediate-mdx-2c9b7328e1df16aec34e.js\"],\"component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-go-mentionables-mdx\":[\"/component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-go-mentionables-mdx-7592ff16e6db29e951da.js\"],\"component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-healthcareless-mdx\":[\"/component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-healthcareless-mdx-38d7fea24a8ded03e896.js\"],\"component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-html-5-and-localization-mdx\":[\"/component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-html-5-and-localization-mdx-d753f413eade587ded8d.js\"],\"component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-java-codestyle-mdx\":[\"/component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-java-codestyle-mdx-9bba893c3a07529ea43a.js\"],\"component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-javascript-mentionables-mdx\":[\"/component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-javascript-mentionables-mdx-4b6b0966676272158acc.js\"],\"component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-mysql-tips-and-tricks-mdx\":[\"/component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-mysql-tips-and-tricks-mdx-13c46c574f0ad3c3dda5.js\"],\"component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-postgres-mentionables-mdx\":[\"/component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-postgres-mentionables-mdx-d93136e8c9be236eddab.js\"],\"component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-redshift-notes-mdx\":[\"/component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-redshift-notes-mdx-7cb08ca64562d393583f.js\"],\"component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-redshift-opinion-mdx\":[\"/component---src-pages-writings-mdx-fields-slug-tsx-content-file-path-blog-redshift-opinion-mdx-8ca358ec0c7010bd9e52.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="85557d09d9db065395db";</script><script src="/webpack-runtime-cbf04a465a522b2b1f53.js" async></script><script src="/framework-468e2957bc488c301f9f.js" async></script><script src="/app-8d476775be3aedc48f61.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>